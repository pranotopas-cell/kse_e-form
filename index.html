<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSE Dashboard - Admin System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --kse-green-dark: #1a3c15; --kse-green-light: #2d5a27; }
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Navbar Styling */
        .navbar-kse { background-color: var(--kse-green-dark); box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .nav-link { color: rgba(255,255,255,0.8) !important; font-weight: 500; cursor: pointer; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { color: #fff !important; background: rgba(255,255,255,0.1); border-radius: 5px; }

        /* A4 Page Styling */
        .page-render {
            width: 210mm;
            height: 297mm;
            padding: 0 15mm 15mm 15mm;
            margin: 20px auto;
            background: white;
            position: relative;
            color: #000;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Elements inside A4 */
        .header-clean { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; padding-top: 10px; }
        .logo-main { height: 60px; width: auto; }
        .title-block { text-align: right; }
        .title-block h2 { font-weight: 900; font-size: 24px; margin: 0; color: var(--kse-green-dark); }
        .en-label { font-size: 9px; font-style: italic; color: #666; display: block; }
        
        .table-custom { width: 100%; border-collapse: collapse; margin-top: 5px; }
        .table-custom th { background-color: var(--kse-green-dark) !important; color: white !important; text-align: center; padding: 6px; font-size: 11px; border: 1px solid #000; }
        .table-custom td { border: 1px solid #000; padding: 5px 10px; font-size: 11px; vertical-align: top; }
        
        .footer-sign { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .footer-sign th { background-color: var(--kse-green-dark) !important; color: white !important; font-size: 10px; padding: 5px; border: 1px solid #000; text-align: center; }
        .footer-sign td { border: 1px solid #000; height: 80px; vertical-align: bottom; padding: 5px; font-size: 10px; font-weight: bold; text-align: center; position: relative; }
        .img-stempel { position: absolute; width: 85px; bottom: 15px; left: 50%; transform: translateX(-50%); opacity: 0.7; pointer-events: none; }

        .fixed-footer { position: absolute; bottom: 10mm; left: 15mm; right: 15mm; border-top: 1px solid #eee; padding-top: 5px; }
        .footer-content { display: flex; justify-content: space-between; align-items: flex-end; }
        .footer-name { font-weight: bold; font-size: 14px; color: var(--kse-green-dark); }
        .contact-item { font-size: 8.5px; margin-bottom: 0px; text-align: right; }

        /* UI Control */
        .section-module { display: none; }
        .section-module.active { display: block; }
        @media print { .no-print { display: none !important; } .page-render { margin: 0; box-shadow: none; } }
    </style>
</head>
<body onload="initApp()">

<nav class="navbar navbar-expand-lg navbar-dark navbar-kse no-print mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">KSE SYSTEM</a>
        <div class="navbar-nav">
            <a class="nav-link active" onclick="switchMod('penawaran', this)">PENAWARAN</a>
            <a class="nav-link" onclick="switchMod('suratjalan', this)">SURAT JALAN</a>
            <a class="nav-link" onclick="switchMod('po', this)">PURCHASE ORDER</a>
            <a class="nav-link" onclick="switchMod('invoice', this)">INVOICE</a>
        </div>
    </div>
</nav>

<div class="container no-print">
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white fw-bold text-success border-bottom">
            Panel Input <span id="active-title">Penawaran</span>
        </div>
        <div class="card-body bg-light">
            <div id="input-container" class="row g-2">
                </div>
            <div class="mt-3 text-end">
                <button class="btn btn-dark btn-sm" onclick="updatePreview()">Preview</button>
                <button class="btn btn-success btn-sm" onclick="downloadPDF()">Download PDF (A4)</button>
            </div>
        </div>
    </div>
</div>

<div id="render-area">
    <div id="surat-jalan-render" class="page-render">
        <div class="header-clean">
            <img src="header1.png" class="logo-main" alt="Logo KSE">
            <div class="title-block">
                <h2 id="doc-title-main">SURAT JALAN</h2>
                <span id="doc-title-en" class="en-label">DELIVERY ORDER</span>
            </div>
        </div>

        <div class="row" style="font-size: 12px; margin-bottom: 10px;">
            <div class="col-7">
                <div class="mb-1">Kepada Yth:</div>
                <strong id="p_pt" style="font-size: 16px; color: var(--kse-green-dark);">PT. CUSTOMER NAME</strong>
                <div id="p_lokasi_box" class="mt-2" style="font-size: 11px; line-height: 1.4;">
                    Alamat/Lokasi: <span id="p_alamat" class="fw-bold">-</span><br>
                    Up: <span id="p_cp" class="fw-bold">-</span>
                </div>
            </div>
            <div class="col-5 text-end">
                <table class="ms-auto" style="font-size: 11px;">
                    <tr><td class="text-start pe-2">TANGGAL</td><td class="text-start">: <span id="p_tgl"></span></td></tr>
                    <tr><td class="text-start pe-2">NOMOR</td><td class="text-start">: <span id="p_nomor"></span></td></tr>
                    <tr id="row_po"><td class="text-start pe-2">REF PO</td><td class="text-start">: <span id="p_ref_po">-</span></td></tr>
                </table>
            </div>
        </div>

        <table class="table-custom" id="main-table">
            <thead>
                <tr id="table-head">
                    </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>

        <div id="p_statement" class="statement-text mt-3">
            "Barang yang sudah dibeli tidak dapat dikembalikan kecuali ada perjanjian sebelumnya."
        </div>

        <table class="footer-sign" id="sign-table">
            </table>

        <div class="other-note-box mt-3 p-2 border" style="font-size: 10px; min-height: 60px;">
            <strong>Catatan Tambahan:</strong><br>
            <span id="p_notes">-</span>
        </div>

        <div class="fixed-footer">
            <div class="footer-content">
                <div class="footer-cap" style="font-size: 8px; color: #999; font-style: italic;">
                    Dokumen ini sah secara sistem e-Form KSE.<br>Dicetak pada: <span id="print-time"></span>
                </div>
                <div class="company-info-footer">
                    <div class="footer-name text-end">PT. KHATULISTIWA SINAR ENERGI</div>
                    <div class="contact-item">Pangkalan Bun, Kalimantan Tengah</div>
                    <div class="contact-item">pt.khatulistiwa.sinar.energi@gmail.com | 0815-884-141-0</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentMod = 'penawaran';

    const configs = {
        penawaran: {
            title: "SURAT PENAWARAN", en: "QUOTATION",
            fields: ['No_QUO', 'Penerima', 'Alamat', 'Hal', 'Produk', 'Harga_Satuan'],
            tableHead: ['NO', 'DESKRIPSI BARANG', 'QTY', 'HARGA SATUAN', 'TOTAL'],
            sign: ['Hormat Kami', 'Disetujui Oleh'],
            statement: "Penawaran ini berlaku selama 7 hari kerja sejak tanggal diterbitkan."
        },
        suratjalan: {
            title: "SURAT JALAN", en: "DELIVERY ORDER",
            fields: ['No_SJ', 'Penerima', 'Lokasi', 'No_PO', 'Sopir', 'Nopol', 'Jenis_BBM', 'Segel'],
            tableHead: ['ITEM', 'SPESIFIKASI', 'KETERANGAN', 'JUMLAH'],
            sign: ['Penerima', 'Sopir', 'Admin Gudang', 'Mengetahui'],
            statement: "Barang diterima dalam keadaan baik dan tersegel. Komplain tidak dilayani setelah surat ditandatangani."
        },
        po: {
            title: "PURCHASE ORDER", en: "PESANAN PEMBELIAN",
            fields: ['No_PO', 'Supplier', 'Alamat_S', 'Syarat_Bayar', 'Tgl_Kirim'],
            tableHead: ['KODE', 'NAMA BARANG', 'JUMLAH', 'SATUAN', 'TOTAL'],
            sign: ['Dibuat Oleh', 'Disetujui', 'Supplier'],
            statement: "Harap lampirkan salinan PO ini pada saat penagihan/invoice."
        },
        invoice: {
            title: "INVOICE", en: "FAKTUR PENAGIHAN",
            fields: ['No_INV', 'Penagihan_Ke', 'No_SJ_Ref', 'Bank_Transfer', 'Jatuh_Tempo'],
            tableHead: ['RINCIAN PEKERJAAN / BARANG', 'VOLUME', 'HARGA', 'JUMLAH'],
            sign: ['Diterima Oleh', 'Hormat Kami'],
            statement: "Pembayaran dianggap sah apabila dana telah masuk ke rekening perusahaan."
        }
    };

    function initApp() {
        renderInputs('penawaran');
        updatePreview();
    }

    function switchMod(mod, el) {
        currentMod = mod;
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('active-title').innerText = configs[mod].title;
        renderInputs(mod);
        updatePreview();
    }

    function renderInputs(mod) {
        const container = document.getElementById('input-container');
        const fields = configs[mod].fields;
        let html = '';
        fields.forEach(f => {
            html += `<div class="col-md-3">
                        <label class="small fw-bold text-muted">${f.replace('_', ' ')}</label>
                        <input type="text" class="form-control form-control-sm border-success" id="in_${f}" value="${f === 'Penerima' ? 'PT. KARYA DUTA SEJAHTERA' : '-'}" oninput="updatePreview()">
                     </div>`;
        });
        html += `<div class="col-md-12"><label class="small fw-bold">Catatan Tambahan</label><input type="text" class="form-control form-control-sm" id="in_notes" value="-"></div>`;
        container.innerHTML = html;
        
        // Auto Date
        const d = new Date();
        document.getElementById('in_' + fields[0]).value = `00${Math.floor(Math.random()*9)}/KSE/${mod.toUpperCase().substring(0,3)}/2026`;
    }

    function updatePreview() {
        const conf = configs[currentMod];
        document.getElementById('doc-title-main').innerText = conf.title;
        document.getElementById('doc-title-en').innerText = conf.en;
        document.getElementById('p_statement').innerText = conf.statement;
        document.getElementById('print-time').innerText = new Date().toLocaleString();

        // Map Inputs to Render
        document.getElementById('p_nomor').innerText = document.getElementById('in_' + conf.fields[0]).value;
        document.getElementById('p_pt').innerText = document.getElementById('in_' + conf.fields[1]).value;
        document.getElementById('p_alamat').innerText = document.getElementById('in_' + conf.fields[2]).value;
        document.getElementById('p_notes').innerText = document.getElementById('in_notes').value;
        document.getElementById('p_tgl').innerText = new Date().toLocaleDateString('id-ID', {day:'2-digit', month:'long', year:'numeric'});

        // Render Table Head
        let headHtml = '';
        conf.tableHead.forEach(h => headHtml += `<th>${h}</th>`);
        document.getElementById('table-head').innerHTML = headHtml;

        // Render Table Body (Dummy Content based on Module)
        let bodyHtml = `<tr>${'<td>-</td>'.repeat(conf.tableHead.length)}</tr>`;
        for(let i=0; i<4; i++) bodyHtml += `<tr>${'<td>&nbsp;</td>'.repeat(conf.tableHead.length)}</tr>`;
        document.getElementById('table-body').innerHTML = bodyHtml;

        // Render Signatures
        let signHead = '<tr>';
        let signBody = '<tr>';
        conf.sign.forEach((s, idx) => {
            signHead += `<th>${s.toUpperCase()}</th>`;
            let stempel = (s.toLowerCase().includes('admin') || s.toLowerCase().includes('hormat')) ? `<img src="stempel.png" class="img-stempel">` : '';
            signBody += `<td>${stempel}<br><br>..........................</td>`;
        });
        document.getElementById('sign-table').innerHTML = `<thead>${signHead}</tr></thead><tbody>${signBody}</tr></tbody>`;
    }

    function downloadPDF() {
        const element = document.getElementById('surat-jalan-render');
        const filename = `KSE_${currentMod.toUpperCase()}_${document.getElementById('p_nomor').innerText}.pdf`;
        
        const opt = {
            margin: 0,
            filename: filename,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 3, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
