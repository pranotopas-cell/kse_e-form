<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSE - Penawaran Harga Resmi</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        * { box-sizing: border-box; -webkit-print-color-adjust: exact; }
        body { background: #525659; margin: 0; display: flex; font-family: 'Arial', sans-serif; color: #333; }

        /* Panel Input Sidebar */
        .sidebar { width: 380px; background: #1e272e; color: white; padding: 25px; height: 100vh; position: fixed; overflow-y: auto; z-index: 100; box-shadow: 4px 0 10px rgba(0,0,0,0.3); }
        .sidebar h2 { font-size: 18px; border-bottom: 2px solid #05c46b; padding-bottom: 10px; margin-bottom: 20px; color: #05c46b; }
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; margin-bottom: 4px; color: #d2dae2; font-size: 11px; font-weight: bold; }
        .input-group input { width: 100%; padding: 10px; background: #2f3542; border: 1px solid #57606f; color: white; border-radius: 5px; outline: none; }
        
        .actions { margin-top: 25px; display: flex; flex-direction: column; gap: 10px; }
        .btn { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-align: center; text-decoration: none; transition: 0.3s; }
        .btn-home { background: #485460; color: white; }
        .btn-print { background: #1e90ff; color: white; }
        .btn-save { background: #05c46b; color: white; }

        /* Preview Area */
        .preview-area { margin-left: 380px; padding: 40px; width: 100%; display: flex; justify-content: center; }
        .a4-sheet { 
            width: 210mm; 
            height: 296mm; 
            background: white; 
            padding: 15mm 20mm; 
            position: relative; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5); 
            color: #000; 
            overflow: hidden; 
        }

        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 25px; 
            margin-top: -5mm; 
        }
        .logo-img { height: 45px; width: auto; object-fit: contain; }
        .header-meta { text-align: right; }
        .header-meta h1 { margin: 0; font-size: 22px; font-weight: bold; color: #000; line-height: 1.1; }
        .sub-eng { font-size: 11px; color: #666; font-style: italic; display: block; margin-bottom: 5px; }
        
        .meta-table { margin-left: auto; font-size: 12px; border-collapse: collapse; }
        .meta-table td { padding: 1px 0; vertical-align: top; }
        .meta-table td:nth-child(2) { padding: 0 8px; }
        .lang-en-sm { display: block; font-size: 10px; color: #777; font-style: italic; line-height: 1; }

        .doc-content { font-size: 13px; line-height: 1.4; }
        
        /* Lebarkan jarak antara alamat dan isi surat sesuai instruksi */
        .recipient { margin-bottom: 35px; } 

        .main-table { width: 100%; border-collapse: collapse; margin: 15px 0 5px 0; }
        .main-table th { background: #1a3a1a; color: white; border: 1px solid #000; padding: 8px 5px; font-size: 11px; }
        .main-table td { border: 1px solid #000; padding: 8px; }
        
        .price-box div { display: flex; justify-content: space-between; margin-bottom: 2px; }
        .total-row { border-top: 1.5px solid #000; padding-top: 3px; margin-top: 3px; font-weight: bold; font-size: 14px; }
        .table-note { font-size: 10px; font-style: italic; margin-bottom: 15px; }

        .terms-table { font-size: 12.5px; width: 100%; border-collapse: collapse; margin-top: 5px; }
        .terms-table td { padding: 3px 0; vertical-align: top; }

        .regards { margin-top: 20px; line-height: 1.3; }
        .img-signature { height: 100px; width: auto; margin: 5px 0; display: block; }

        .footer { position: absolute; bottom: 12mm; left: 20mm; right: 20mm; }
        .footer-line { border-top: 1.5px solid #000; margin-bottom: 8px; }
        .footer-grid { display: flex; justify-content: space-between; align-items: flex-end; }
        .footer-left { display: flex; align-items: center; gap: 10px; }
        #qrcode-small canvas, #qrcode-small img { width: 50px !important; height: 50px !important; }
        .footer-right { text-align: right; font-size: 9px; color: #000; line-height: 1.3; }

        @media print {
            .sidebar { display: none; }
            .preview-area { margin: 0; padding: 0; }
            .a4-sheet { box-shadow: none; margin: 0; border: none; }
            body { background: white; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>PANEL KSE</h2>
        <div class="input-group"><label>Nomor Penawaran</label><input type="text" id="inNomor" value="045/KSE-SPH/II/2026" oninput="draw()"></div>
        <div class="input-group"><label>Tanggal Surat</label><input type="text" id="inTgl" value="23 FEBRUARI 2026" oninput="draw()"></div>
        <div class="input-group"><label>Periode Harga</label><input type="text" id="inPrd" value="FEBRUARI 2026" oninput="draw()"></div>
        <div class="input-group"><label>Nama PT Tujuan</label><input type="text" id="inPT" value="PIMPINAN PERUSAHAAN" oninput="draw()"></div>
        <div class="input-group"><label>Alamat / Kota</label><input type="text" id="inAlm" value="Di Tempat" oninput="draw()"></div>
        <div class="input-group"><label>Harga Dasar (Rp)</label><input type="number" id="inHrg" value="15586" oninput="draw()"></div>
        <div class="input-group"><label>Sistem Pembayaran</label><input type="text" id="inPay" value="TOP 7 hari setelah Invoice diterima" oninput="draw()"></div>
        <div class="input-group"><label>Kontak Person</label><input type="text" id="inContact" value="08158841410" oninput="draw()"></div>

        <div class="actions">
            <a href="index.html" class="btn btn-home">Home (index.html)</a>
            <button onclick="window.print()" class="btn btn-print">Print Preview</button>
            <button onclick="saveA4()" class="btn btn-save">Save Download A4</button>
        </div>
    </div>

    <div class="preview-area">
        <div id="print-document" class="a4-sheet">
            <div class="header">
                <img src="header1.png" alt="Logo KSE" class="logo-img" onerror="this.src='https://via.placeholder.com/150x80?text=LOGO+KSE'">
                <div class="header-meta">
                    <h1>PENAWARAN HARGA</h1>
                    <span class="sub-eng">Official Fuel Quotation</span>
                    <table class="meta-table">
                        <tr><td>Tanggal <span class="lang-en-sm">Date</span></td><td>:</td><td><span id="outTgl">...</span></td></tr>
                        <tr><td>Nomor <span class="lang-en-sm">Ref No</span></td><td>:</td><td><span id="outNomor">...</span></td></tr>
                        <tr><td>Periode <span class="lang-en-sm">Period</span></td><td>:</td><td><span id="outPrd">...</span></td></tr>
                    </table>
                </div>
            </div>

            <div class="doc-content">
                <div class="recipient">Kepada Yth,<br><strong id="outPT">...</strong><br><span id="outAlm">...</span></div>
                
                <p>Dengan hormat,<br>Bersama ini kami <strong>PT. Khatulistiwa Sinar Energi</strong> mitra penyalur bbm industri, menawarkan supply bbm untuk operasional perusahaan Bapak / Ibu, dengan rincian harga sebagai berikut :</p>

                <table class="main-table">
                    <thead>
                        <tr>
                            <th width="5%">No</th>
                            <th width="25%">Produk <span class="lang-en-sm">Product</span></th>
                            <th width="20%">Tujuan <span class="lang-en-sm">Destination</span></th>
                            <th width="35%">Rincian Harga <span class="lang-en-sm">Price Details</span></th>
                            <th width="15%">Satuan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td align="center">1</td>
                            <td align="center"><strong>Bbm Solar B40</strong></td>
                            <td align="center">site Tarjun</td>
                            <td class="price-box">
                                <div><span>Harga Dasar</span> <span>Rp <span id="outHrg">0</span></span></div>
                                <div><span>PPN (11%)</span> <span>Rp <span id="outPpn">0</span></span></div>
                                <div class="total-row"><span>Grand Total</span> <span>Rp <span id="outTotal">0</span></span></div>
                            </td>
                            <td align="center">Liter</td>
                        </tr>
                    </tbody>
                </table>
                <div class="table-note">* Harga tersebut di atas sudah termasuk PPN 11% dan OAT (Ongkos Angkut Transportir).</div>

                <table class="terms-table">
                    <tr><td width="35%">Sistem pembayaran <span class="lang-en-sm">Payment terms</span></td><td>: <strong id="outPay">...</strong></td></tr>
                    <tr><td>Quantity <span class="lang-en-sm">Order Quantity</span></td><td>: 5.000 / 10.000 ltr</td></tr>
                    <tr><td>Toleransi <span class="lang-en-sm">Tolerance</span></td><td>: 0,3 % (Standard Fuel)</td></tr>
                    <tr><td>Kontak Person <span class="lang-en-sm">Contact Person</span></td><td>: <span id="outContact">...</span></td></tr>
                </table>

                <p style="margin-top: 15px;">Demikian penawaran ini kami sampaikan, besar harapan kami bisa menjalin kerja sama dengan perusahaan Bapak / Ibu. Atas perhatiannya kami ucapkan Terima Kasih.</p>

                <div class="regards">
                    Regard,<br><strong>PT. Khatulistiwa Sinar Energi</strong>
                    <img src="ttd.png" alt="Tanda Tangan" class="img-signature" onerror="this.src='https://via.placeholder.com/100x50?text=ttd.png'">
                </div>
            </div>

            <div class="footer">
                <div class="footer-line"></div>
                <div class="footer-grid">
                    <div class="footer-left">
                        <div id="qrcode-small"></div>
                        <div style="font-size: 8.5px; line-height: 1.3;">
                            <strong>Digital E-Form KSE System</strong><br>
                            Ref ID: <span id="outID">...</span><br>
                            Scan QR untuk Validasi Penawaran
                        </div>
                    </div>
                    <div class="footer-right">
                        <strong>PT. KHATULISTIWA SINAR ENERGI</strong><br>
                        Mitra Penyalur dan Transportir BBM Industri<br>
                        Jl. H.M. Rafii RT. 24 Pangkalan Bun, Kalimantan Tengah<br>
                        pt.khatulistiwa.sinar.energi@gmail.com
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inisialisasi QR Code
        const qrContainer = document.getElementById("qrcode-small");
        const qrSm = new QRCode(qrContainer, { width: 50, height: 50 });

        // Fungsi Load Data Terakhir
        function loadSavedData() {
            const savedData = localStorage.getItem('kse_last_input');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('inNomor').value = data.no || "";
                document.getElementById('inTgl').value = data.tgl || "";
                document.getElementById('inPrd').value = data.prd || "";
                document.getElementById('inPT').value = data.pt || "";
                document.getElementById('inAlm').value = data.alm || "";
                document.getElementById('inHrg').value = data.hrg || "";
                document.getElementById('inPay').value = data.pay || "";
                document.getElementById('inContact').value = data.contact || "";
            }
        }

        function draw() {
            const no = document.getElementById('inNomor').value;
            const tgl = document.getElementById('inTgl').value;
            const prd = document.getElementById('inPrd').value;
            const pt = document.getElementById('inPT').value;
            const alm = document.getElementById('inAlm').value;
            const hrgValue = document.getElementById('inHrg').value;
            const pay = document.getElementById('inPay').value;
            const contact = document.getElementById('inContact').value;

            const hrg = parseFloat(hrgValue) || 0;
            const ppn = Math.round(hrg * 0.11);
            const total = hrg + ppn;

            // Update Tampilan
            document.getElementById('outNomor').innerText = no;
            document.getElementById('outTgl').innerText = tgl;
            document.getElementById('outPrd').innerText = prd;
            document.getElementById('outPT').innerText = pt;
            document.getElementById('outAlm').innerText = alm;
            document.getElementById('outHrg').innerText = hrg.toLocaleString('id-ID');
            document.getElementById('outPpn').innerText = ppn.toLocaleString('id-ID');
            document.getElementById('outTotal').innerText = total.toLocaleString('id-ID');
            document.getElementById('outPay').innerText = pay;
            document.getElementById('outContact').innerText = contact;
            document.getElementById('outID').innerText = no;

            // Save ke LocalStorage
            const dataToSave = { no, tgl, prd, pt, alm, hrg: hrgValue, pay, contact };
            localStorage.setItem('kse_last_input', JSON.stringify(dataToSave));

            // Generate QR Otomatis
            const qrText = `DOKUMEN RESMI PT KSE\nNo: ${no}\nHal: Penawaran Harga BBM\nTujuan: ${pt}\nTotal: Rp ${total.toLocaleString('id-ID')}\nTanggal: ${tgl}`;
            qrSm.clear(); 
            qrSm.makeCode(qrText);
        }

        function saveA4() {
            const element = document.getElementById('print-document');
            const noFile = document.getElementById('inNomor').value.replace(/\//g, '-');
            const ptFile = document.getElementById('inPT').value;
            
            const opt = {
                margin: 0,
                filename: `${noFile}_${ptFile}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save();
        }
        
        // Eksekusi saat load
        window.onload = function() {
            loadSavedData();
            draw();
        };
    </script>
</body>
</html>
