<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSE - Berita Acara Oper Muatan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root { --kse-primary: #062006; }
        body { background-color: #f4f7f6; font-family: 'Arial', sans-serif; font-size: 11px; }
        
        .control-nav { background: #fff; border-bottom: 2px solid #ddd; padding: 10px 20px; position: sticky; top: 0; z-index: 1000; }
        .input-sidebar { background: #fff; height: calc(100vh - 60px); overflow-y: auto; padding: 20px; border-right: 1px solid #ddd; }
        
        .document-canvas { 
            background: white; width: 210mm; min-height: 296mm; 
            margin: 10px auto; padding: 15mm 20mm; position: relative;
            box-shadow: 0 0 15px rgba(0,0,0,0.1); color: #000;
        }

        /* Hilangkan garis bawah di header sesuai permintaan */
        .header-section { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; border-bottom: none !important; padding-bottom: 10px; }
        .logo-img { height: 45px; width: auto; }
        .ba-title { text-align: center; margin-bottom: 25px; }
        .ba-title h5 { font-weight: 900; text-decoration: underline; margin-bottom: 5px; font-size: 14px; }

        .section-title { background: #eee; padding: 4px 10px; font-weight: bold; margin: 15px 0 10px 0; border-left: 4px solid var(--kse-primary); }
        .data-grid { display: grid; grid-template-columns: 1fr; gap: 5px; margin-left: 10px; }
        .data-row { display: flex; margin-bottom: 3px; }
        .data-label { width: 160px; position: relative; }
        .data-label::after { content: ":"; position: absolute; right: 10px; }

        .signature-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 40px; text-align: center; }
        .sig-box { height: 120px; display: flex; flex-direction: column; justify-content: space-between; }

        .footer-kse { position: absolute; bottom: 8mm; width: calc(100% - 40mm); border-top: 1px solid #ccc; padding-top: 8px; }

        @media print {
            .control-nav, .input-sidebar { display: none !important; }
            body { background: white; padding: 0; }
            .document-canvas { margin: 0; box-shadow: none; width: 210mm; height: 297mm; padding: 15mm 20mm !important; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

<div class="control-nav shadow-sm d-flex justify-content-between align-items-center">
    <div class="d-flex gap-2">
        <a href="index.html" class="btn btn-outline-dark btn-sm"><i class="bi bi-arrow-left"></i> KEMBALI</a>
        <button class="btn btn-dark btn-sm" onclick="window.print()"><i class="bi bi-printer"></i> PRINT</button>
    </div>
    <button class="btn btn-primary btn-sm fw-bold px-4" onclick="downloadPDF()"><i class="bi bi-file-pdf"></i> SIMPAN PDF</button>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-3 input-sidebar shadow-sm">
            <h6 class="fw-bold text-primary border-bottom pb-2">NOMOR & WAKTU</h6>
            <input type="text" id="in_no" class="form-control form-control-sm mb-2" placeholder="Nomor BA" oninput="updateView()">
            <input type="text" id="in_hari" class="form-control form-control-sm mb-2" placeholder="Hari" oninput="updateView()">
            <input type="text" id="in_tgl_lengkap" class="form-control form-control-sm mb-2" placeholder="Tanggal Lengkap" oninput="updateView()">

            <h6 class="fw-bold text-success border-bottom pb-2 mt-3">SUMBER (BONGKAR)</h6>
            <input type="text" id="s_nopol" class="form-control form-control-sm mb-1" placeholder="Nopol" oninput="updateView()">
            <input type="text" id="s_pt" class="form-control form-control-sm mb-1" placeholder="Perusahaan" oninput="updateView()">
            <input type="text" id="s_segel_a" class="form-control form-control-sm mb-1" placeholder="Segel Atas" oninput="updateView()">
            <input type="text" id="s_segel_b" class="form-control form-control-sm mb-1" placeholder="Segel Bawah" oninput="updateView()">
            <input type="number" id="s_qty" class="form-control form-control-sm mb-1" placeholder="Qty" oninput="updateView()">
            <input type="text" id="s_tc" class="form-control form-control-sm mb-1" placeholder="TC" oninput="updateView()">
            <input type="text" id="s_sopir" class="form-control form-control-sm mb-1" placeholder="Nama Sopir" oninput="updateView()">

            <h6 class="fw-bold text-danger border-bottom pb-2 mt-3">TUJUAN (MUAT)</h6>
            <input type="text" id="t_nopol" class="form-control form-control-sm mb-1" placeholder="Nopol" oninput="updateView()">
            <input type="text" id="t_pt" class="form-control form-control-sm mb-1" placeholder="Perusahaan" oninput="updateView()">
            <input type="number" id="t_qty" class="form-control form-control-sm mb-1" placeholder="Qty" oninput="updateView()">
            <input type="text" id="t_tc" class="form-control form-control-sm mb-1" placeholder="TC" oninput="updateView()">
            <input type="text" id="t_sopir" class="form-control form-control-sm mb-1" placeholder="Nama Sopir" oninput="updateView()">
        </div>

        <div class="col-lg-9 p-0" id="pdf-area">
            <div class="document-canvas">
                <div class="header-section">
                    <img src="header1.png" class="logo-img" onerror="this.src='https://via.placeholder.com/140x40/062006/FFFFFF?text=PT.+KSE'">
                    <div class="text-end"><small>Form: KSE-BAOM-2026</small></div>
                </div>

                <div class="ba-title">
                    <h5>BERITA ACARA OPER MUATAN BAHAN BAKAR MINYAK (BBM)</h5>
                    <span>Nomor: <span id="out_no"></span></span>
                </div>

                <p>Pada hari ini <b id="out_hari"></b>, <span id="out_tgl_lengkap"></span>, bertempat di <b>Pangkalan Bun</b> telah dilakukan pemindahan muatan BBM:</p>

                <div class="section-title">DATA SUMBER MUATAN</div>
                <div class="data-grid">
                    <div class="data-row"><div class="data-label">Nopol</div><div id="os_nopol"></div></div>
                    <div class="data-row"><div class="data-label">Nama Perusahaan</div><div id="os_pt"></div></div>
                    <div class="data-row"><div class="data-label">Nomor Segel Atas</div><div id="os_segel_a"></div></div>
                    <div class="data-row"><div class="data-label">Nomor Segel Bawah</div><div id="os_segel_b"></div></div>
                    <div class="data-row"><div class="data-label">Quantity</div><div id="os_qty" class="fw-bold"></div></div>
                    <div class="data-row"><div class="data-label">Tc saat Bongkar</div><div id="os_tc"></div></div>
                    <div class="data-row"><div class="data-label">Nama Sopir</div><div id="os_sopir"></div></div>
                </div>

                <div class="section-title">DATA TANGKI TUJUAN</div>
                <div class="data-grid">
                    <div class="data-row"><div class="data-label">Nopol</div><div id="ot_nopol"></div></div>
                    <div class="data-row"><div class="data-label">Nama Perusahaan</div><div id="ot_pt"></div></div>
                    <div class="data-row"><div class="data-label">Quantity</div><div id="ot_qty" class="fw-bold"></div></div>
                    <div class="data-row"><div class="data-label">Tc saat Muat</div><div id="ot_tc"></div></div>
                    <div class="data-row"><div class="data-label">Nama Sopir</div><div id="ot_sopir"></div></div>
                </div>

                <div class="signature-grid">
                    <div class="sig-box">
                        <span>Sopir Penyerah</span>
                        <div class="mt-auto"><b>( <span id="os_sopir_sig">......................</span> )</b></div>
                    </div>
                    <div class="sig-box">
                        <span>Sopir Penerima</span>
                        <div class="mt-auto"><b>( <span id="ot_sopir_sig">......................</span> )</b></div>
                    </div>
                    <div class="sig-box">
                        <span><b>Mengetahui,</b></span>
                        <div class="mt-auto">
                            <br><br><b>....................................</b><br><small>Operasional</small>
                        </div>
                    </div>
                </div>

                <div class="footer-kse">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=60x60&data=VALID_OPER_MUATAN_KSE" width="50">
                            <div style="font-size: 8px; color: #555;">
                                <b>KSE LOGISTICS SYSTEM</b><br>
                                Digital Signature & QR Validated<br>
                                Dokumen Sah PT. Khatulistiwa Sinar Energi
                            </div>
                        </div>
                        <div class="text-end">
                            <b style="font-size: 10px; color: var(--kse-primary);">PT. KHATULISTIWA SINAR ENERGI</b><br>
                            <span style="font-size: 8px; color: #444;">Jl. H.M. Rafi'i RT.24 Pangkalan Bun, Kalteng</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function updateView() {
        const mapping = {
            'in_no': 'out_no', 'in_hari': 'out_hari', 'in_tgl_lengkap': 'out_tgl_lengkap',
            's_nopol': 'os_nopol', 's_pt': 'os_pt', 's_segel_a': 'os_segel_a', 's_segel_b': 'os_segel_b',
            's_tc': 'os_tc', 's_sopir': 'os_sopir', 
            't_nopol': 'ot_nopol', 't_pt': 'ot_pt', 't_tc': 'ot_tc', 't_sopir': 'ot_sopir'
        };

        for (let id in mapping) {
            const el = document.getElementById(id);
            const out = document.getElementById(mapping[id]);
            if(el && out) out.innerText = el.value;
        }
        
        document.getElementById('os_sopir_sig').innerText = document.getElementById('s_sopir').value || "......................";
        document.getElementById('ot_sopir_sig').innerText = document.getElementById('t_sopir').value || "......................";

        const sqty = document.getElementById('s_qty').value;
        document.getElementById('os_qty').innerText = sqty ? parseFloat(sqty).toLocaleString('id-ID') + " Liter" : "-";
        
        const tqty = document.getElementById('t_qty').value;
        document.getElementById('ot_qty').innerText = tqty ? parseFloat(tqty).toLocaleString('id-ID') + " Liter" : "-";
    }

    function downloadPDF() {
        const element = document.getElementById('pdf-area');
        html2pdf().set({
            margin: 0,
            filename: 'BA_Oper_Muatan.pdf',
            html2canvas: { scale: 3 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        }).from(element).save();
    }

    window.onload = function() {
        // PERBAIKAN: Jika index.html error, baris di bawah ini penyebabnya.
        // Saya beri komentar (disable) supaya Anda bisa melihat hasilnya dulu.
        /* if (localStorage.getItem('kse_session') !== 'active') {
            window.location.href = 'index.html'; 
            return;
        }
        */

        // Data Default
        document.getElementById('in_no').value = "012 / BA-OM / KSE / I / 2026";
        document.getElementById('in_hari').value = "Jumat";
        document.getElementById('in_tgl_lengkap').value = "23 Januari 2026";
        updateView();
    };
</script>
</body>
</html>
